"use strict";angular.module("neurocidEditorApp",["ngSanitize","ngRoute","xeditable"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]).run(["editableOptions",function(a){a.theme="default"}]),angular.module("neurocidEditorApp").controller("MainCtrl",["$scope","canvas","Editor",function(a,b,c){a.isHidden=!0,a.ship={getShipCount:function(){return b.canvasShapes().length},currentObj:function(){return"undefined"!=typeof b?b.lib.getActiveObject():void 0}},b.initMouseEvent(),a.toggleProperties=function(){a.isHidden=!a.isHidden},a.addShip=function(a){c.addShip(a)},a.addLine=function(a,b){for(var d=0;a>d;d++)c.addShip(b)},a.exportJson=function(){window.open("data:text/json;charset=utf-8,"+escape(JSON.stringify(c.getJson())))},a.canvasShapes=function(){return b.canvasShapes()},a.getProperties=function(){a.properties=c.getShipProperties(this.shape),a.toggleProperties(),c.centerEditor(this.shape,a.properties.loc[1],a.properties.loc[0])}}]).filter("isValue",function(){return function(a,b){return a==b?a:void 0}}).filter("iif",function(){return function(a,b,c){return a?b:c}}),angular.module("neurocidEditorApp").filter("getTypeOfPropertie",function(){return function(a){return typeof a}}),angular.module("neurocidEditorApp").filter("setInputField",["$sce",function(a){return function(b,c){switch(typeof b){case"number":return a.trustAsHtml('<input type="number" name="'+c+'" ng-model="model_'+c+'" value="'+b+'" />');case"boolean":return console.log(c,typeof b),a.trustAsHtml('<label><input type="checkbox" name="'+c+'" ng-model="model_'+c+' value="left" bs-checkbox/> '+c+"</label>");case"object":return a.trustAsHtml("<hr>")}}}]),angular.module("neurocidEditorApp").factory("canvas",function(){{var a=new fabric.Canvas("canvas");new Image}a.backgroundColor=new fabric.Pattern({source:"images/bp.png"}),a.renderAll(),a.setHeight(3e3),a.setWidth(3e3),a.selectionColor="rgba(255,255,255,0.3)",a.selectionDashArray=[10,10],a.selectionBorderColor="blue",a.selectionLineWidth=3,a.allowTouchScrolling=!0,a.renderAll();{var b=document.getElementById("editor");b.clientHeight/2,b.clientWidth/2}b.scrollTop=1500,b.scrollLeft=1500;var c=(new Array,1),d=1.2,e=function(c,d,e,f){c&&(b.scrollLeft=b.scrollLeft-100),e&&(b.scrollTop=b.scrollTop-100),d&&(b.scrollLeft=b.scrollLeft+100),f&&(b.scrollTop=b.scrollTop+100),a.calcOffset()};return{initMouseEvent:function(){a.on("mouse:down",function(a){var c=a.e.layerX-b.scrollLeft<=100,d=a.e.layerX-b.scrollLeft>=b.clientWidth-100,f=a.e.layerY-b.scrollTop<=100,g=a.e.layerY-b.scrollTop>=b.clientHeight-100;(c||d||f||g)&&e(c,d,f,g)})},set:function(b){a.add(b),a.renderAll(),a.calcOffset()},setCanvasScale:function(){c/=d},canvasShapes:function(){return a.getObjects()},setActiveObject:function(b){return a.setActiveObject(b)},calcOffset:function(){return a.calcOffset()},renderAll:function(){return a.renderAll()},toJSON:function(){return a.toJSON()}}}),angular.module("neurocidEditorApp").factory("Ship",["canvas",function(a){var b=100,c=0,d=[],e=fabric.util.createClass(fabric.Circle,{type:"ship",initialize:function(a){a||(a={}),this.callSuper("initialize",a),this.set({_controlsVisibility:{bl:!1,br:!1,mb:!1,ml:!1,mr:!1,mt:!1,mtr:!0,tl:!1,tr:!1},lockScalingY:!0,lockScalingX:!0,lockUniScaling:!0,padding:5,radius:3,fill:"red"}),this.set("propertyId",a.propertyId||0),this.set("teamA",a.teamA||!0),this.set("isDummy",a.isDummy||!1),this.set("canShoot",a.canShoot||!0),this.set("canRotate",a.canRotate||!0),this.set("canMove",a.canMove||!0),this.set("disableProjectileFitness",a.disableProjectileFitness||!1),this.set("range",a.range||50),this.set("maxSpeed",a.maxSpeed||1),this.set("maxRotation",a.maxRotation||1),this.set("maxFuel",a.maxFuel||1e5),this.set("fuelRate",a.fuelRate||1),this.set("maxCooldown",a.maxCooldown||5),this.set("maxAmmo",a.maxAmmo||5),this.set("maxDamage",a.maxDamage||6),this.set("crashesPerDamage",a.crashesPerDamage||1),this.set("numPerfDesc",a.numPerfDesc||4),this.set("startFuel",a.startFuel||1e3),this.set("hardness",a.hardness||100),this.set("startammo",a.startammo||0),this.set("fitnessfunction",a.fitnessfunction||"amir")},toObject:function(){return fabric.util.object.extend(this.callSuper("toObject"),{propertyId:this.get("propertyId"),teamA:this.get("teamA"),isDummy:this.get("isDummy"),canShoot:this.get("canShoot"),canRotate:this.get("canRotate"),canMove:this.get("canMove"),disableProjectileFitness:this.get("disableProjectileFitness"),range:this.get("range"),maxSpeed:this.get("maxSpeed"),maxRotation:this.get("maxRotation"),maxFuel:this.get("maxFuel"),fuelRate:this.get("fuelRate"),maxCooldown:this.get("maxCooldown"),maxAmmo:this.get("maxAmmo"),maxDamage:this.get("maxDamage"),crashesPerDamage:this.get("crashesPerDamage"),numPerfDesc:this.get("numPerfDesc"),startFuel:this.get("startFuel"),hardness:this.get("hardness"),startammo:this.get("startammo"),fitnessfunction:this.get("fitnessfunction")})},_render:function(a){this.callSuper("_render",a)}});return this.getShips=function(){var c=_.omit(a.toJSON(),"background"),d=[],e=[];_.each(c.objects,function(a){var c=_.omit(a,"backgroundColor","flipX","flipY","height","opacity","originX","originY","scaleX","scaleY","shadow","stroke","strokeDashArray","strokeLineJoin","strokeMiterLimit","type","visible","clipTo","fill","strokeLineCap","strokeWidth","width","radius");c.loc=[c.left*b,c.top*b],c.rotation=c.angle,c=_.omit(c,"left","top","angle"),console.log("test"),c.teamA?(c=_.omit(c,"TeamA"),d.push(c)):(c=_.omit(c,"TeamA"),e.push(c))});var f={TeamA:d,TeamB:e};return f},this.getCanvas=function(){return console.log(a),a},this.createShip=function(b,f,g){if(b){var h=new e({left:f,top:g});c+=1,h.propertyId=c,h.angle=90,h.radius=3,d.push(h)}else{var h=new e({left:100,top:20+20*a.canvasShapes().length});c+=1,h.propertyId=c,h.teamA=!1,h.radius=3,h.fill="blue",h.angle=270,d.push(h)}return a.set(h)},this.getProperties=function(a){var b=_.omit(a.toJSON(),"backgroundColor","flipX","flipY","height","opacity","originX","originY","scaleX","scaleY","shadow","stroke","strokeDashArray","strokeLineJoin","strokeMiterLimit","type","visible","clipTo","fill","strokeLineCap","strokeWidth","width","radius");return b.loc=[b.left,b.top],b.rotation=b.angle,b=_.omit(b,"left","top")},this.exportSenario=function(){console.log(Team);var a={BattleFieldLayout:{width:3e5,height:3e5,iterations:1500},PhysicsLayout:{gravity:[0,0],timeStep:.033,positionIterations:2,velocityIterations:6,coordToMetersFactor:.03},ScannerLayout:{disableClusterCenters:!0,numClusters:3,numFriends:20,numEnemies:20,numProjectiles:20},TeamA:Team.TeamA,TeamB:Team.TeamB};return a},this}]),angular.module("neurocidEditorApp").factory("Editor",["canvas","Ship",function(a,b){var c={getShipProperties:function(a){return b.getProperties(a)},centerEditor:function(b,c,d){var e=document.getElementById("editor"),f=e.clientHeight/2,g=e.clientWidth/2;e.scrollTop=c-f,e.scrollLeft=d-g,a.setActiveObject(b),a.calcOffset()},addShip:function(a){var c=document.getElementById("editor"),d=c.clientHeight/2,e=c.clientWidth/2;b.createShip(a,c.scrollLeft+e,c.scrollTop+d)},getJson:function(){var a=b.getShips(),c={BattleFieldLayout:{width:6e5,height:6e5,iterations:1500},PhysicsLayout:{gravity:[0,0],timeStep:.033,positionIterations:2,velocityIterations:6,coordToMetersFactor:.03},ScannerLayout:{disableClusterCenters:!0,numClusters:3,numFriends:10,numFriendFacilities:3,numEnemies:10,numEnemyFacilities:3,numProjectiles:10},PlacerLayout:{center:[3e5,3e5],distance:1e4,placer:"placer/opposite",rotation:0,spacing:100},FacilitiesA:[{radius:50,range:50,maxCooldown:5,loc:[11041,11161],rotation:52.47}],FacilitiesB:[{radius:50,range:50,maxCooldown:5,loc:[11041,11161],rotation:52.47}],TeamA:a.TeamA,TeamB:a.TeamB};return console.log(c),c}};return c}]);